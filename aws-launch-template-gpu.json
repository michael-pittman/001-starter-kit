{
  "LaunchTemplateName": "ai-starter-kit-gpu-ubuntu24-optimized",
  "LaunchTemplateData": {
    "ImageId": "ami-0aa28dab1f2852040",
    "InstanceType": "g4dn.xlarge",
    "KeyName": "YOUR_KEY_PAIR_NAME",
    "SecurityGroupIds": [
      "sg-gpu-ai-starter-kit"
    ],
    "IamInstanceProfile": {
      "Name": "AI-Starter-Kit-GPU-Instance-Profile"
    },
    "UserData": "IyEvYmluL2Jhc2gKY3VybCAtcyBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vbWljaGFlbC1waXR0bWFuLzAwMS1zdGFydGVyLWtpdC9tYWluL2Nsb3VkLWluaXQtZ3B1LXVidW50dTI0LnNoIHwgc3VkbyBiYXNo",
    "TagSpecifications": [
      {
        "ResourceType": "instance",
        "Tags": [
          {
            "Key": "Name",
            "Value": "AI-Starter-Kit-GPU-Optimized"
          },
          {
            "Key": "Project",
            "Value": "AI-Starter-Kit"
          },
          {
            "Key": "Environment",
            "Value": "production"
          },
          {
            "Key": "Workload",
            "Value": "ai-ml-gpu"
          },
          {
            "Key": "CostOptimization",
            "Value": "spot-eligible"
          },
          {
            "Key": "AutoShutdown",
            "Value": "enabled"
          },
          {
            "Key": "GPUType",
            "Value": "nvidia-t4"
          },
          {
            "Key": "ModelSupport",
            "Value": "deepseek-r1-qwen2.5-vl-snowflake-arctic"
          }
        ]
      },
      {
        "ResourceType": "volume",
        "Tags": [
          {
            "Key": "Name",
            "Value": "AI-Starter-Kit-GPU-Volume"
          },
          {
            "Key": "Backup",
            "Value": "daily"
          },
          {
            "Key": "Encryption",
            "Value": "enabled"
          }
        ]
      }
    ],
    "BlockDeviceMappings": [
      {
        "DeviceName": "/dev/sda1",
        "Ebs": {
          "VolumeSize": 100,
          "VolumeType": "gp3",
          "Iops": 3000,
          "Throughput": 125,
          "DeleteOnTermination": true,
          "Encrypted": true
        }
      },
      {
        "DeviceName": "/dev/sdf",
        "Ebs": {
          "VolumeSize": 200,
          "VolumeType": "gp3",
          "Iops": 4000,
          "Throughput": 250,
          "DeleteOnTermination": false,
          "Encrypted": true
        }
      }
    ],
    "Monitoring": {
      "Enabled": true
    },
    "CreditSpecification": {
      "CpuCredits": "standard"
    },
    "MetadataOptions": {
      "HttpTokens": "required",
      "HttpPutResponseHopLimit": 2,
      "HttpEndpoint": "enabled",
      "HttpProtocolIpv6": "disabled",
      "InstanceMetadataTags": "enabled"
    },
    "NetworkInterfaces": [
      {
        "DeviceIndex": 0,
        "AssociatePublicIpAddress": true,
        "Groups": [
          "sg-gpu-ai-starter-kit"
        ],
        "InterfaceType": "interface",
        "Ipv6AddressCount": 0,
        "DeleteOnTermination": true
      }
    ],
    "Placement": {
      "AvailabilityZone": "us-east-1a",
      "GroupName": "",
      "HostId": "",
      "Tenancy": "default",
      "SpreadDomain": "",
      "HostResourceGroupArn": "",
      "PartitionNumber": 0
    },
    "DisableApiTermination": false,
    "InstanceInitiatedShutdownBehavior": "terminate",
    "EbsOptimized": true,
    "CpuOptions": {
      "CoreCount": 2,
      "ThreadsPerCore": 2
    },
    "CapacityReservationSpecification": {
      "CapacityReservationPreference": "open"
    },
    "HibernationOptions": {
      "Configured": false
    },
    "EnclaveOptions": {
      "Enabled": false
    },
    "MaintenanceOptions": {
      "AutoRecovery": "default"
    },
    "PrivateDnsNameOptions": {
      "HostnameType": "ip-name",
      "EnableResourceNameDnsARecord": true,
      "EnableResourceNameDnsAAAARecord": false
    }
  },
  "Description": "Enhanced GPU-optimized launch template for AI Starter Kit with Ubuntu 24.04 NVIDIA AMI, configured for g4dn.xlarge with T4 GPU support, EFS integration, spot instance optimization, and comprehensive monitoring. Supports DeepSeek-R1:8B, Qwen2.5-VL:7B, and Snowflake-Arctic-Embed2:568M models.",
  "VersionDescription": "v1.0 - Initial GPU-optimized configuration with cost optimization and monitoring",
  "SecurityGroupConfiguration": {
    "GroupName": "sg-gpu-ai-starter-kit",
    "Description": "Security group for AI Starter Kit GPU instances",
    "VpcId": "vpc-YOUR_VPC_ID",
    "SecurityGroupRules": [
      {
        "IpPermissions": [
          {
            "IpProtocol": "tcp",
            "FromPort": 22,
            "ToPort": 22,
            "IpRanges": [
              {
                "CidrIp": "0.0.0.0/0",
                "Description": "SSH access"
              }
            ]
          },
          {
            "IpProtocol": "tcp",
            "FromPort": 5678,
            "ToPort": 5678,
            "IpRanges": [
              {
                "CidrIp": "0.0.0.0/0",
                "Description": "n8n web interface"
              }
            ]
          },
          {
            "IpProtocol": "tcp",
            "FromPort": 11434,
            "ToPort": 11434,
            "IpRanges": [
              {
                "CidrIp": "0.0.0.0/0",
                "Description": "Ollama API"
              }
            ]
          },
          {
            "IpProtocol": "tcp",
            "FromPort": 6333,
            "ToPort": 6333,
            "IpRanges": [
              {
                "CidrIp": "0.0.0.0/0",
                "Description": "Qdrant vector database"
              }
            ]
          },
          {
            "IpProtocol": "tcp",
            "FromPort": 2049,
            "ToPort": 2049,
            "UserIdGroupPairs": [
              {
                "GroupId": "sg-gpu-ai-starter-kit",
                "Description": "EFS NFS access"
              }
            ]
          },
          {
            "IpProtocol": "tcp",
            "FromPort": 9090,
            "ToPort": 9090,
            "UserIdGroupPairs": [
              {
                "GroupId": "sg-gpu-ai-starter-kit",
                "Description": "Prometheus monitoring"
              }
            ]
          },
          {
            "IpProtocol": "tcp",
            "FromPort": 3000,
            "ToPort": 3000,
            "UserIdGroupPairs": [
              {
                "GroupId": "sg-gpu-ai-starter-kit",
                "Description": "Grafana dashboard"
              }
            ]
          }
        ]
      }
    ]
  },
  "IAMRoleConfiguration": {
    "RoleName": "AI-Starter-Kit-GPU-Instance-Role",
    "AssumeRolePolicyDocument": {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Allow",
          "Principal": {
            "Service": "ec2.amazonaws.com"
          },
          "Action": "sts:AssumeRole"
        }
      ]
    },
    "ManagedPolicyArns": [
      "arn:aws:iam::aws:policy/CloudWatchAgentServerPolicy",
      "arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore"
    ],
    "InlinePolicies": {
      "AIStarterKitGPUPolicy": {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": [
              "ssm:GetParameter",
              "ssm:GetParameters",
              "ssm:GetParametersByPath"
            ],
            "Resource": [
              "arn:aws:ssm:us-east-1:*:parameter/aibuildkit/*"
            ]
          },
          {
            "Effect": "Allow",
            "Action": [
              "elasticfilesystem:AccessPoint",
              "elasticfilesystem:CreateAccessPoint",
              "elasticfilesystem:DescribeAccessPoints",
              "elasticfilesystem:DescribeFileSystems",
              "elasticfilesystem:DescribeMountTargets"
            ],
            "Resource": "*"
          },
          {
            "Effect": "Allow",
            "Action": [
              "cloudwatch:PutMetricData",
              "ec2:DescribeVolumes",
              "ec2:DescribeTags",
              "logs:CreateLogGroup",
              "logs:CreateLogStream",
              "logs:PutLogEvents",
              "logs:DescribeLogStreams"
            ],
            "Resource": "*"
          },
          {
            "Effect": "Allow",
            "Action": [
              "ec2:DescribeInstances",
              "ec2:DescribeInstanceAttribute",
              "ec2:DescribeSpotInstanceRequests",
              "ec2:DescribeSpotPriceHistory"
            ],
            "Resource": "*"
          },
          {
            "Effect": "Allow",
            "Action": [
              "sns:Publish"
            ],
            "Resource": [
              "arn:aws:sns:us-east-1:*:ai-starter-kit-*"
            ]
          }
        ]
      }
    }
  },
  "SpotInstanceConfiguration": {
    "SpotPrice": "0.75",
    "SpotInstanceType": "one-time",
    "SpotFleetRequestConfig": {
      "TargetCapacity": 1,
      "AllocationStrategy": "diversified",
      "IamFleetRole": "arn:aws:iam::ACCOUNT_ID:role/aws-ec2-spot-fleet-tagging-role",
      "LaunchSpecifications": [
        {
          "ImageId": "ami-0aa28dab1f2852040",
          "InstanceType": "g4dn.xlarge",
          "KeyName": "YOUR_KEY_PAIR_NAME",
          "SecurityGroups": [
            {
              "GroupId": "sg-gpu-ai-starter-kit"
            }
          ],
          "SubnetId": "subnet-YOUR_SUBNET_ID",
          "IamInstanceProfile": {
            "Name": "AI-Starter-Kit-GPU-Instance-Profile"
          },
          "UserData": "IyEvYmluL2Jhc2gKY3VybCAtcyBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vbWljaGFlbC1waXR0bWFuLzAwMS1zdGFydGVyLWtpdC9tYWluL2Nsb3VkLWluaXQtZ3B1LXVidW50dTI0LnNoIHwgc3VkbyBiYXNo",
          "WeightedCapacity": 1.0,
          "SpotPrice": "0.75",
          "TagSpecifications": [
            {
              "ResourceType": "instance",
              "Tags": [
                {
                  "Key": "Name",
                  "Value": "AI-Starter-Kit-GPU-Spot"
                },
                {
                  "Key": "SpotInstance",
                  "Value": "true"
                }
              ]
            }
          ]
        },
        {
          "ImageId": "ami-0aa28dab1f2852040",
          "InstanceType": "g4dn.2xlarge",
          "KeyName": "YOUR_KEY_PAIR_NAME",
          "SecurityGroups": [
            {
              "GroupId": "sg-gpu-ai-starter-kit"
            }
          ],
          "SubnetId": "subnet-YOUR_SUBNET_ID",
          "IamInstanceProfile": {
            "Name": "AI-Starter-Kit-GPU-Instance-Profile"
          },
          "UserData": "IyEvYmluL2Jhc2gKY3VybCAtcyBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vbWljaGFlbC1waXR0bWFuLzAwMS1zdGFydGVyLWtpdC9tYWluL2Nsb3VkLWluaXQtZ3B1LXVidW50dTI0LnNoIHwgc3VkbyBiYXNo",
          "WeightedCapacity": 2.0,
          "SpotPrice": "1.25",
          "TagSpecifications": [
            {
              "ResourceType": "instance",
              "Tags": [
                {
                  "Key": "Name",
                  "Value": "AI-Starter-Kit-GPU-Spot-2xlarge"
                },
                {
                  "Key": "SpotInstance",
                  "Value": "true"
                }
              ]
            }
          ]
        }
      ],
      "TerminateInstancesWithExpiration": false,
      "Type": "maintain",
      "ReplaceUnhealthyInstances": true,
      "InstanceInterruptionBehavior": "terminate",
      "TagSpecifications": [
        {
          "ResourceType": "spot-fleet-request",
          "Tags": [
            {
              "Key": "Name",
              "Value": "AI-Starter-Kit-GPU-Spot-Fleet"
            },
            {
              "Key": "Purpose",
              "Value": "cost-optimized-ai-workload"
            }
          ]
        }
      ]
    }
  },
  "AutoScalingConfiguration": {
    "AutoScalingGroupName": "ai-starter-kit-gpu-asg",
    "MinSize": 0,
    "MaxSize": 3,
    "DesiredCapacity": 1,
    "HealthCheckGracePeriod": 300,
    "HealthCheckType": "EC2",
    "DefaultCooldown": 300,
    "VPCZoneIdentifiers": [
      "subnet-YOUR_SUBNET_ID_1",
      "subnet-YOUR_SUBNET_ID_2",
      "subnet-YOUR_SUBNET_ID_3"
    ],
    "TerminationPolicies": [
      "OldestInstance"
    ],
    "Tags": [
      {
        "Key": "Name",
        "Value": "AI-Starter-Kit-GPU-ASG",
        "PropagateAtLaunch": true,
        "ResourceId": "ai-starter-kit-gpu-asg",
        "ResourceType": "auto-scaling-group"
      }
    ],
    "MixedInstancesPolicy": {
      "LaunchTemplate": {
        "LaunchTemplateSpecification": {
          "LaunchTemplateName": "ai-starter-kit-gpu-ubuntu24-optimized",
          "Version": "$Latest"
        },
        "Overrides": [
          {
            "InstanceType": "g4dn.xlarge",
            "WeightedCapacity": "1",
            "SpotPrice": "0.75"
          },
          {
            "InstanceType": "g4dn.2xlarge",
            "WeightedCapacity": "2",
            "SpotPrice": "1.25"
          }
        ]
      },
      "InstancesDistribution": {
        "OnDemandAllocationStrategy": "prioritized",
        "OnDemandBaseCapacity": 0,
        "OnDemandPercentageAboveBaseCapacity": 30,
        "SpotAllocationStrategy": "capacity-optimized-prioritized",
        "SpotInstancePools": 3,
        "SpotMaxPrice": "1.50"
      }
    }
  },
  "MonitoringConfiguration": {
    "CloudWatchDashboard": {
      "DashboardName": "AI-Starter-Kit-GPU-Performance",
      "DashboardBody": {
        "widgets": [
          {
            "type": "metric",
            "properties": {
              "metrics": [
                ["AWS/EC2", "CPUUtilization", "InstanceId", "${InstanceId}"],
                ["CWAgent", "gpu_utilization", "InstanceId", "${InstanceId}"],
                ["CWAgent", "gpu_memory_utilization", "InstanceId", "${InstanceId}"],
                ["CWAgent", "gpu_temperature", "InstanceId", "${InstanceId}"]
              ],
              "period": 300,
              "stat": "Average",
              "region": "us-east-1",
              "title": "GPU Performance Metrics"
            }
          }
        ]
      }
    },
    "CloudWatchAlarms": [
      {
        "AlarmName": "GPU-High-Utilization",
        "MetricName": "gpu_utilization",
        "Namespace": "CWAgent",
        "Statistic": "Average",
        "Period": 300,
        "EvaluationPeriods": 3,
        "Threshold": 90,
        "ComparisonOperator": "GreaterThanThreshold"
      },
      {
        "AlarmName": "GPU-High-Temperature",
        "MetricName": "gpu_temperature",
        "Namespace": "CWAgent",
        "Statistic": "Average",
        "Period": 300,
        "EvaluationPeriods": 2,
        "Threshold": 80,
        "ComparisonOperator": "GreaterThanThreshold"
      }
    ]
  },
  "CostOptimizationFeatures": {
    "SpotInstanceSavings": "Up to 70% compared to On-Demand",
    "AutoShutdown": "Idle instances terminated after 12 hours",
    "ResourceOptimization": "Right-sized for T4 GPU workloads",
    "EBSOptimization": "GP3 volumes with optimal IOPS/throughput ratio",
    "NetworkOptimization": "Enhanced networking for reduced data transfer costs"
  },
  "DeploymentInstructions": {
    "CLI": "aws ec2 create-launch-template --cli-input-json file://aws-launch-template-gpu.json",
    "Console": "Upload this JSON file in AWS EC2 Console > Launch Templates > Create Launch Template",
    "Terraform": "Use aws_launch_template resource with this configuration",
    "CloudFormation": "Convert to CloudFormation template format"
  }
} 